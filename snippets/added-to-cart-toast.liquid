<div id="atc-toast" class="atc-toast" aria-hidden="true">
  <div class="inner">Added to cart <span class="title"></span>. <a href="/cart">View cart</a></div>
</div>
<style>
.atc-toast{position:fixed;left:50%;transform:translate(-50%,10px);bottom:20px;background:#111;color:#fff;padding:12px 14px;border-radius:12px;z-index:70;box-shadow:0 10px 30px rgba(0,0,0,.25);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s}
.atc-toast.show{opacity:1; pointer-events:auto; transform:translate(-50%,0)}
.atc-toast .inner a{color:#F7E06A; margin-left:8px}
</style>
<script>
(function(){
  function toast(txt){
    var t = document.getElementById('atc-toast'); if(!t) return;
    t.querySelector('.title').textContent = txt ? 'â€“ ' + txt : '';
    t.classList.add('show');
    setTimeout(function(){ t.classList.remove('show'); }, 3000);
  }
  async function bubble(){
    try{
      const res = await fetch('/cart.js'); const cart = await res.json();
      const b = document.getElementById('cart-icon-bubble') || document.querySelector('.cart-count-bubble');
      if (b){ const n = cart.item_count||0; b.innerHTML = n ? '<span aria-hidden="true">'+n+'</span>' : ''; }
    }catch(e){}
  }
  document.addEventListener('submit', function(e){
    const f = e.target; if(!(f instanceof HTMLFormElement)) return;
    const method = (f.getAttribute('method')||'').toLowerCase();
    const action = f.getAttribute('action')||'';
    if (method !== 'post' || !/\/cart\/add/.test(action)) return;
    const id = f.querySelector('input[name="id"]'); if(!id) return;
    e.preventDefault();
    const fd = new FormData(f);
    fetch('/cart/add.js', {method:'POST', headers:{'Accept':'application/json'}, body:fd})
      .then(r => r.json())
      .then(data => { toast(data?.title || 'Added'); bubble(); })
      .catch(() => { f.submit(); });
  }, true);
})();
</script>

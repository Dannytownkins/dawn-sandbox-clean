{% if template.name == 'product' %}
<style>
.szg-row{display:flex;gap:12px;align-items:center;margin:6px 0 10px}
.szg-link{font-weight:600;text-decoration:underline;cursor:pointer}
.szg-modal[aria-hidden="true"]{display:none}
.szg-modal{position:fixed;inset:0;z-index:80}
.szg-overlay{position:absolute;inset:0;background:rgba(0,0,0,.45)}
.szg-dialog{position:relative;max-width:720px;margin:6vh auto;background:#fff;border-radius:18px;padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.25)}
.szg-close{position:absolute;top:10px;right:12px;background:#f2f2f2;border:none;border-radius:999px;width:32px;height:32px;font-size:18px;cursor:pointer}
.szg-body img{width:100%;height:auto;display:block}
</style>
<div class="szg-row">
  <button class="szg-link" type="button" data-open-szg>Size guide</button>
</div>
<div id="szg-modal" class="szg-modal" aria-hidden="true">
  <div class="szg-overlay" data-close-szg></div>
  <div class="szg-dialog" role="dialog" aria-modal="true" aria-labelledby="szg-title">
    <button class="szg-close" type="button" aria-label="Close" data-close-szg>×</button>
    <h3 id="szg-title" style="margin-top:0">Size guide</h3>
    <div class="szg-body">
      {% comment %}
        Prefer product metafield:
        - Namespace/key: custom.size_chart (file/image OR page reference OR plain text)
      {% endcomment %}
      {% assign sc = product.metafields.custom.size_chart %}
      {% if sc and sc.value %}
        {% if sc.type contains 'file_reference' %}
          <img src="{{ sc.value | image_url: width: 1400 }}" alt="Size chart">
        {% elsif sc.type contains 'page_reference' %}
          {{ sc.value.content }}
        {% else %}
          <div>{{ sc.value }}</div>
        {% endif %}
      {% else %}
        <p>Chest: Measure under arms around fullest part • Waist: Natural waistline • Length: Collar to hem.</p>
        <table style="width:100%;border-collapse:collapse">
          <thead><tr><th align="left">Size</th><th align="left">Chest</th><th align="left">Length</th></tr></thead>
          <tbody>
            <tr><td>S</td><td>34–36"</td><td>27"</td></tr>
            <tr><td>M</td><td>38–40"</td><td>28"</td></tr>
            <tr><td>L</td><td>42–44"</td><td>29"</td></tr>
            <tr><td>XL</td><td>46–48"</td><td>30"</td></tr>
            <tr><td>2XL</td><td>50–52"</td><td>31"</td></tr>
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>
</div>
<script>
(function(){
  var m=document.getElementById('szg-modal'); if(!m) return;
  var open=function(){ m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
  var close=function(){ m.setAttribute('aria-hidden','true'); document.body.style.overflow=''; };
  document.querySelectorAll('[data-open-szg]').forEach(function(b){ b.addEventListener('click', open); });
  m.querySelectorAll('[data-close-szg]').forEach(function(b){ b.addEventListener('click', close); });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
})();
</script>
{% endif %}

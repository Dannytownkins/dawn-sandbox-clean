{% comment %}
  Free Shipping Progress Bar
  
  Usage:
  {% render 'free-shipping-bar' %}
{% endcomment %}

{%- liquid
  assign threshold = settings.free_ship_threshold | times: 100
  assign current = cart.total_price
  assign remaining = threshold | minus: current
  assign progress = current | times: 100 | divided_by: threshold | at_most: 100
  assign is_qualified = false
  if remaining <= 0
    assign is_qualified = true
  endif
-%}

<div class="free-shipping-bar" aria-live="polite" aria-atomic="true">
  <div class="free-shipping-bar__inner">
    {%- if is_qualified -%}
      <p class="free-shipping-bar__message free-shipping-bar__message--qualified">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
          <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
        </svg>
        <span>{{ 'cart.free_shipping.qualified' | t }}</span>
      </p>
    {%- else -%}
      <p class="free-shipping-bar__message">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
          <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-4 0 1 1 0 0 1-1-1v-5zm1.5-.5a.5.5 0 0 0-.5.5v4.084A1.992 1.992 0 0 1 2 7.5a2 2 0 0 1 2-2V3.5a.5.5 0 0 0-.5-.5h-2zM11 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-6 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
        </svg>
        <span>{{ 'cart.free_shipping.message' | t: amount: remaining | money }}</span>
      </p>
      <div class="free-shipping-bar__track">
        <div class="free-shipping-bar__fill" style="width: {{ progress }}%"></div>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .free-shipping-bar {
    padding: 12px 16px;
    background: #f8f9fa;
    border-radius: 8px;
    margin: 16px 0;
  }
  
  .free-shipping-bar__message {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 0 0 8px;
    font-size: 14px;
    font-weight: 600;
    color: #333;
  }
  
  .free-shipping-bar__message--qualified {
    color: #28a745;
    margin-bottom: 0;
  }
  
  .free-shipping-bar__message svg {
    flex-shrink: 0;
  }
  
  .free-shipping-bar__track {
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .free-shipping-bar__fill {
    height: 100%;
    background: linear-gradient(90deg, #eded6b 0%, #d4d44e 100%);
    transition: width 0.3s ease;
    border-radius: 4px;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .free-shipping-bar__fill {
      transition: none;
    }
  }
</style>

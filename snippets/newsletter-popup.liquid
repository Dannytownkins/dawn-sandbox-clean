{% comment %}
  Newsletter exit-intent popup
{% endcomment %}

<div class="newsletter-popup" hidden data-popup>
  <div class="newsletter-popup__dialog" role="dialog" aria-modal="true" aria-labelledby="newsletter-popup-title">
    <button class="newsletter-popup__close" type="button" data-popup-close>&times;</button>
    <h2 id="newsletter-popup-title">{{ settings.newsletter_popup_heading | default: 'Get 10% off' }}</h2>
    <p>{{ settings.newsletter_popup_copy | default: 'Join the Danliora drop list for light and dark humor releases.' }}</p>
    <form method="post" action="{{ settings.newsletter_popup_form_action | default: '/' }}" class="newsletter-popup__form">
      <label class="visually-hidden" for="popup-email">Email</label>
      <input id="popup-email" name="contact[email]" type="email" required placeholder="your@mail.com">
      <input type="text" name="contact[discount_code]" value="{{ settings.newsletter_popup_discount | default: 'DANLIORA10' }}" hidden>
      <button type="submit">{{ settings.newsletter_popup_cta | default: 'Claim discount' }}</button>
    </form>
  </div>
</div>

<style>
  .newsletter-popup {
    position: fixed;
    inset: 0;
    background: rgba(10, 10, 11, 0.75);
    display: grid;
    place-items: center;
    z-index: 200;
  }
  .newsletter-popup__dialog {
    background: #111;
    color: #fff;
    padding: clamp(24px, 5vw, 48px);
    border-radius: 20px;
    max-width: 420px;
    width: min(92vw, 420px);
    display: grid;
    gap: 16px;
    position: relative;
  }
  .newsletter-popup__form {
    display: grid;
    gap: 12px;
  }
  .newsletter-popup__form input[type="email"] {
    padding: 12px;
    border-radius: 10px;
    border: none;
  }
  .newsletter-popup__form button {
    padding: 12px;
    border-radius: 10px;
    background: #eded6b;
    border: none;
    font-weight: 700;
    color: #111;
    cursor: pointer;
  }
  .newsletter-popup__close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.7);
    font-size: 24px;
    cursor: pointer;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const popup = document.querySelector('[data-popup]');
    if (!popup) return;
    const closeBtn = popup.querySelector('[data-popup-close]');
    const showPopup = () => {
      popup.hidden = false;
    };
    const closePopup = () => {
      popup.hidden = true;
      localStorage.setItem('newsletter-popup-dismissed', 'true');
    };
    closeBtn.addEventListener('click', closePopup);
    popup.addEventListener('click', (event) => {
      if (event.target === popup) closePopup();
    });
    if (!localStorage.getItem('newsletter-popup-dismissed')) {
      window.addEventListener('mouseout', (event) => {
        if (!event.relatedTarget && !event.toElement && event.clientY <= 0) {
          showPopup();
        }
      });
    }
  });
</script>

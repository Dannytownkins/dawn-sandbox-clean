{% if template.name == 'product' %}
<div class="pdp-sticky-atc" data-sticky-atc hidden>
  <div class="pdp-sticky-atc__inner">
    <div class="pdp-sticky-atc__media">
      {% if product.featured_image %}
        <img src="{{ product.featured_image | image_url: width: 120 }}" alt="{{ product.title | escape }}" loading="lazy" width="48" height="48">
      {% endif %}
    </div>
    <div class="pdp-sticky-atc__meta">
      <div class="pdp-sticky-atc__title">{{ product.title }}</div>
      <div class="pdp-sticky-atc__price">{{ product.price | money }}</div>
    </div>
    <product-form>
      <form action="{{ routes.cart_add_url }}" method="post">
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        <button class="button button--primary">Add to cart</button>
      </form>
    </product-form>
  </div>
</div>
<script>
  (function(){
    const bar = document.querySelector('[data-sticky-atc]');
    const target = document.querySelector('form[action="/cart/add"]');
    if(!bar || !target) return;
    const io = new IntersectionObserver(([e]) => {
      bar.hidden = e.isIntersecting;
    }, {rootMargin: "-120px 0px 0px 0px", threshold: 0});
    io.observe(target);
  })();
</script>
{% endif %}

